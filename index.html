<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Slot Clicker â€” Pastel Edition</title>
<style>
  :root{
    --bg:#fbfafc;         /* ã»ã‚“ã®ã‚Šä¹³ç™½ */
    --panel:#ffffff;      /* ã‚«ãƒ¼ãƒ‰ãƒ»ãƒ‘ãƒãƒ«èƒŒæ™¯ */
    --muted:#7b7b89;
    --accent:#f76b6b;
    --pastel-blue:#cfe8ff;
    --pastel-green:#d8f7dc;
    --pastel-yellow:#fff1c9;
    --pastel-pink:#ffe9f0;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    background:var(--bg);
    font-family: Inter, system-ui, -apple-system, "Helvetica Neue", Arial;
    color:#222;
    display:flex;
    justify-content:center;
    padding:12px;
    min-height:100vh;
  }

  .container{
    width:1200px;
    max-width:100%;
    display:flex;
    gap:12px;
    align-items:flex-start;
  }

  /* å·¦ï¼šã‚¹ãƒ­ãƒƒãƒˆ */
  .left{
    flex:1;
    background:var(--panel);
    border-radius:12px;
    padding:12px;
    box-shadow:0 6px 18px rgba(20,20,40,0.06);
    display:flex;
    flex-direction:column;
    gap:10px;
    min-height:640px;
  }
  .xpbar{height:14px;background:#f1f4f8;border-radius:8px;overflow:hidden;margin-bottom:6px}
  .xpfill{height:100%;width:0%;background:linear-gradient(90deg,var(--pastel-pink),var(--pastel-yellow));transition:width 300ms}
  .leveltxt{font-size:13px;color:var(--muted)}
  .slot-grid{
    display:grid;
    grid-template-columns:repeat(3,1fr);
    gap:8px;
    width:100%;
    /* make area keep some padding for glow */
    padding:10px;
    border-radius:12px;
    transition:box-shadow .5s, border-color .5s;
    border:6px solid rgba(0,0,0,0.03);
    background:linear-gradient(180deg,#ffffff,#fbfbfd);
  }
  .cell{
    aspect-ratio:8/5; /* preserved as requested */
    border:3px solid rgba(0,0,0,0.06);
    border-radius:8px;
    background:#fff;
    display:flex;
    align-items:center;
    justify-content:center;
    overflow:hidden;
    position:relative;
    box-shadow: 0 2px 6px rgba(20,20,40,0.04);
  }
  .cell img{width:100%;height:100%;object-fit:contain;pointer-events:none}
  .controls{display:flex;align-items:center;gap:12px;flex-wrap:wrap}
  button{cursor:pointer;border:0;background:#222;color:#fff;padding:8px 12px;border-radius:8px;font-weight:600}
  #spinBtn{background:var(--accent);font-weight:800;padding:10px 16px}
  .stop-row{display:flex;gap:8px}
  .stopBtn{background:#f7c948;color:#111;padding:8px 12px;border-radius:8px}
  .status{display:flex;gap:16px;align-items:center;margin-top:6px;font-size:14px;color:#333}
  .hand-wrap{margin-top:6px}
  .hand-label{font-size:13px;color:var(--muted);margin-bottom:6px}
  .hand{
    display:flex;
    gap:12px;
    flex-wrap:wrap;
    padding:10px;
    border-radius:12px;
    background:linear-gradient(180deg,#ffffff,#fffafc);
    border:1px solid rgba(0,0,0,0.04);
    min-height:120px;
    align-items:flex-start;
    overflow:auto;
  }

  /* card UI (bigger & pastel white base) */
  .card{
    width:120px;               /* larger */
    aspect-ratio:5/8;         /* requested 5:8 */
    background:var(--panel);
    border-radius:10px;
    border:1px solid rgba(0,0,0,0.06);
    box-shadow:0 6px 18px rgba(20,20,40,0.06);
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:space-between;
    padding:8px;
    cursor:pointer;
    transition:transform .12s, box-shadow .12s;
    text-align:center;
    font-size:13px;
  }
  .card:hover{transform:translateY(-6px);box-shadow:0 10px 24px rgba(20,20,40,0.12)}
  .card img{width:88%;height:auto;max-height:56%;}
  .card .meta{width:100%}
  .card .name{font-weight:700;margin-top:4px;color:#2b2b2b}
  .card .cost{margin-top:6px;font-weight:700;color:var(--accent)}

  /* å³ï¼šã‚¯ãƒªãƒƒã‚¯ + ã‚¹ã‚­ãƒ« */
  .right{
    width:380px;
    display:flex;
    flex-direction:column;
    gap:12px;
  }
  .panel{
    background:var(--panel);
    padding:12px;border-radius:12px;box-shadow:0 6px 18px rgba(20,20,40,0.06)
  }

  /* clicker */
  .clicker-center{display:flex;flex-direction:column;align-items:center;gap:8px}
  #clickBtn{
    width:180px;height:180px;border-radius:50%;overflow:hidden;display:flex;align-items:center;justify-content:center;
    border:6px solid rgba(0,0,0,0.06);background:linear-gradient(180deg,var(--pastel-pink),#fff);
    cursor:pointer;transition:transform .08s, box-shadow .12s;
  }
  #clickBtn img{width:86%;height:86%;object-fit:contain;border-radius:50%}
  #clickBtn:active{transform:scale(.95)}
  .upgrades{display:flex;gap:8px;flex-wrap:wrap;justify-content:center;margin-top:6px}
  .upgradeBtn{background:#8fb9ff;color:#fff;padding:8px 12px;border-radius:8px;border:0;cursor:pointer}

  /* skills */
  .skills-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px}
  .skill-btn{background:var(--pastel-blue);border-radius:8px;padding:10px;border:1px solid rgba(0,0,0,0.04);cursor:pointer;display:flex;flex-direction:column;align-items:flex-start;gap:6px}
  .skill-line{display:flex;justify-content:space-between;width:100%}
  .skill-meta{font-size:12px;color:var(--muted)}

  /* toast */
  .toast{
    position:fixed;right:18px;top:18px;background:#111;color:#fff;padding:10px 14px;border-radius:8px;opacity:0.98;
    box-shadow:0 8px 30px rgba(0,0,0,0.25);
  }

  /* responsive */
  @media(max-width:1100px){
    .container{flex-direction:column;width:100%}
    .right{width:100%}
  }
</style>
</head>
<body>
<div class="container">

  <!-- LEFT: SLOT -->
  <div class="left panel" id="leftPanel">
    <div class="xpbar"><div id="xpFill" class="xpfill"></div></div>
    <div class="leveltxt">Lv <span id="level">1</span> â€¢ XP <span id="xp">0</span>/<span id="xpNeed">5</span></div>

    <div class="slot-grid" id="slotGrid">
      <!-- cells injected by JS (aspect 8:5 preserved) -->
    </div>

    <div class="controls">
      <div class="stop-row">
        <button class="stopBtn" id="stop0" disabled>å·¦ãƒªãƒ¼ãƒ«åœæ­¢</button>
        <button class="stopBtn" id="stop1" disabled>ä¸­ãƒªãƒ¼ãƒ«åœæ­¢</button>
        <button class="stopBtn" id="stop2" disabled>å³ãƒªãƒ¼ãƒ«åœæ­¢</button>
      </div>

      <div style="display:flex;align-items:center;gap:8px;">
        <button id="spinBtn">ã‚¹ãƒ”ãƒ³ ( -20 )</button>
        <div class="small">å›ºå®šãƒ™ãƒƒãƒˆ: 20</div>
      </div>
    </div>

    <div class="status">
      <div>ã‚³ã‚¤ãƒ³: <strong id="coin">100</strong></div>
      <div>ãƒãƒŠ: <strong id="mana">0</strong></div>
      <!-- luck hidden intentionally -->
    </div>

    <div class="hand-wrap">
      <div class="hand-label">æ‰‹æœ­ï¼ˆã‚¯ãƒªãƒƒã‚¯ã§ä½¿ç”¨ï¼‰</div>
      <div class="hand" id="hand"></div>
    </div>

  </div>

  <!-- RIGHT: CLICKER + SKILLS -->
  <div class="right">

    <div class="panel clicker">
      <div class="clicker-center">
        <div id="clickBtn"><img id="clickImg" src="images/click1.png" alt="click"></div>
        <div class="upgrades">
          <button id="upgradeClick" class="upgradeBtn">ã‚¯ãƒªãƒƒã‚¯+ (å¿…è¦ãƒãƒŠ: <span id="cost_click">2</span>)</button>
          <button id="upgradeAuto" class="upgradeBtn">è‡ªå‹•+1/s (å¿…è¦ãƒãƒŠ: <span id="cost_auto">3</span>)</button>
        </div>
      </div>
      <div class="small" style="margin-top:8px">ã‚¯ãƒªãƒƒã‚¯Power: <span id="clickPower">1</span> â€¢ è‡ªå‹•Power: <span id="autoPower">0</span></div>
    </div>

    <div class="panel skills">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <strong>ã‚¹ã‚­ãƒ«ãƒ„ãƒªãƒ¼ (ãƒœã‚¿ãƒ³å¼)</strong>
        <div class="small">ã‚¹ã‚­ãƒ«P: <span id="skillPoint">0</span></div>
      </div>

      <div class="skills-grid" id="skillsGrid">
        <!-- skill buttons injected by JS -->
      </div>
    </div>

  </div>
</div>

<!-- toast -->
<div id="toastHolder" style="position:fixed;right:18px;top:18px;z-index:1200"></div>

<script>
/* -------------------------
   Constants & image lists
   ------------------------- */
const IMAGES = {
  slots: Array.from({length:9},(_,i)=>`images/slot${i+1}.png`),
  cards: Array.from({length:7},(_,i)=>`images/card${i+1}.png`),
  clicks: ['images/click1.png'] // fixed single click image
};

/* -------------------------
   Game state
   ------------------------- */
let coin = 100;
let mana = 0;
let xp = 0;
let level = 1;
let skillPoint = 0;

let clickPower = 1;
let autoPower = 0;

let hand = [];
let deck = [];
let discard = [];

let spinning = [false,false,false];
let spinIntervals = [null,null,null];
let spinLock = false;

let luck = 50; // hidden param, 1..100, can exceed 100 by effects

// card/system flags
let insuranceActive = false;   // ä¿é™ºã‚«ãƒ¼ãƒ‰
let doubleNext = false;        // æ¬¡ã‚¹ãƒ”ãƒ³å ±é…¬2å€
let superspinActiveCount = 0;  // ã‚¹ãƒ¼ãƒ‘ãƒ¼ã‚¹ãƒ”ãƒ³ï¼ˆãƒ©ãƒƒã‚¯+30 applied next spin)

/* -------------------------
   Card definitions (user-specified)
   1. ãƒªãƒ­ãƒ¼ãƒ« 2ãƒãƒŠ
   2. 2å€     2ãƒãƒŠ
   3. ãƒ‰ãƒ­ãƒ¼   3ãƒãƒŠ
   4. ä¿é™º    2ãƒãƒŠ
   5. ã‚¹ãƒ¼ãƒ‘ãƒ¼ã‚¹ãƒ”ãƒ³ 3ãƒãƒŠ
   6. ãƒãƒŠå›å¾© 1ãƒãƒŠ
   7. ã‚³ã‚¤ãƒ³+ 1ãƒãƒŠ
   ------------------------- */
const cardPool = [
  {id:1,name:'ãƒªãƒ­ãƒ¼ãƒ«', cost:2, img:IMAGES.cards[0]},
  {id:2,name:'2å€', cost:2, img:IMAGES.cards[1]},
  {id:3,name:'ãƒ‰ãƒ­ãƒ¼', cost:3, img:IMAGES.cards[2]},
  {id:4,name:'ä¿é™º', cost:2, img:IMAGES.cards[3]},
  {id:5,name:'ã‚¹ãƒ¼ãƒ‘ãƒ¼ã‚¹ãƒ”ãƒ³', cost:3, img:IMAGES.cards[4]},
  {id:6,name:'ãƒãƒŠå›å¾©', cost:1, img:IMAGES.cards[5]},
  {id:7,name:'ã‚³ã‚¤ãƒ³+', cost:1, img:IMAGES.cards[6]}
];

/* -------------------------
   Utilities
   ------------------------- */
const $ = id => document.getElementById(id);
function randInt(n){ return Math.floor(Math.random()*n); }
function showToast(text, ms=2500){
  const d = document.createElement('div'); d.className='toast'; d.textContent=text;
  $('toastHolder').appendChild(d);
  setTimeout(()=> d.remove(), ms);
}

/* -------------------------
   Deck/Hand management
   ------------------------- */
function initDeck(){
  deck = [];
  // multiple copies so player can draw variety
  for(let i=0;i<3;i++){
    cardPool.forEach(c => deck.push(Object.assign({},c)));
  }
  shuffle(deck);
  discard = [];
  hand = [];
}
function shuffle(arr){
  for(let i=arr.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]] = [arr[j],arr[i]];
  }
}
function drawCard(){
  const maxHand = 7;
  if(hand.length >= maxHand) return;
  if(deck.length===0){ deck = discard; discard = []; shuffle(deck); }
  if(deck.length>0){
    hand.push(deck.pop());
    renderHand();
  }
}
function renderHand(){
  const parent = $('hand');
  parent.innerHTML = '';
  hand.forEach((c,idx)=>{
    const el = document.createElement('div'); el.className='card';
    // show card image, name, cost
    const img = document.createElement('img'); img.src = c.img; img.alt = c.name;
    const name = document.createElement('div'); name.className='name'; name.textContent = c.name;
    const cost = document.createElement('div'); cost.className='cost'; cost.textContent = `ãƒãƒŠ ${c.cost}`;
    el.appendChild(img);
    const meta = document.createElement('div'); meta.className='meta';
    meta.appendChild(name); meta.appendChild(cost);
    el.appendChild(meta);
    el.onclick = ()=> playCard(idx);
    parent.appendChild(el);
  });
}
function playCard(idx){
  const c = hand[idx];
  if(!c) return;
  if(mana < c.cost){ showToast('ãƒãƒŠä¸è¶³'); return; }
  mana -= c.cost;
  updateUI();
  // move to discard
  discard.push(c);
  hand.splice(idx,1);
  renderHand();
  // apply effect
  applyCardEffect(c);
}

/* -------------------------
   Card effects implementation
   ------------------------- */
function applyCardEffect(card){
  switch(card.id){
    case 1: // ãƒªãƒ­ãƒ¼ãƒ«
      showReelChooserForReroll();
      break;
    case 2: // 2å€
      doubleNext = true;
      showToast('æ¬¡ã®ã‚¹ãƒ”ãƒ³å ±é…¬ãŒ2å€ã«ãªã‚Šã¾ã™');
      break;
    case 3: // ãƒ‰ãƒ­ãƒ¼
      drawCard();
      showToast('ã‚«ãƒ¼ãƒ‰ã‚’1æšãƒ‰ãƒ­ãƒ¼ã—ã¾ã—ãŸ');
      break;
    case 4: // ä¿é™º
      insuranceActive = true;
      showToast('ä¿é™ºã‚’ã‚»ãƒƒãƒˆã—ã¾ã—ãŸï¼ˆæ¬¡ã®æå¤±è£œå¡«ï¼‰');
      break;
    case 5: // ã‚¹ãƒ¼ãƒ‘ãƒ¼ã‚¹ãƒ”ãƒ³
      superspinActiveCount = Math.max(superspinActiveCount,1);
      showToast('ã‚¹ãƒ¼ãƒ‘ãƒ¼ã‚¹ãƒ”ãƒ³ã‚’ä½¿ç”¨ï¼šãƒ©ãƒƒã‚¯ã«å¤§ããªè£œæ­£ãŒå…¥ã‚Šã¾ã™');
      break;
    case 6: // ãƒãƒŠå›å¾©
      mana += 3;
      updateUI();
      showToast('ãƒãƒŠ+3');
      break;
    case 7: // ã‚³ã‚¤ãƒ³+
      coin += 10;
      updateUI();
      showToast('ã‚³ã‚¤ãƒ³+10');
      break;
  }
}

/* -------------------------
   Reroll chooser UI
   ------------------------- */
function showReelChooserForReroll(){
  // semi-transparent overlay with 3 buttons
  const overlay = document.createElement('div');
  overlay.style.position='fixed';
  overlay.style.left=0; overlay.style.top=0; overlay.style.right=0; overlay.style.bottom=0;
  overlay.style.display='flex'; overlay.style.alignItems='center'; overlay.style.justifyContent='center';
  overlay.style.background='rgba(0,0,0,0.25)'; overlay.style.zIndex=9999;

  const box = document.createElement('div');
  box.style.background='var(--panel)'; box.style.padding='14px'; box.style.borderRadius='12px';
  box.style.display='flex'; box.style.gap='10px'; box.style.boxShadow='0 10px 30px rgba(0,0,0,0.15)';

  for(let i=0;i<3;i++){
    const b = document.createElement('button');
    b.textContent = ['å·¦ãƒªãƒ¼ãƒ«å†ã‚¹ãƒ”ãƒ³','ä¸­ãƒªãƒ¼ãƒ«å†ã‚¹ãƒ”ãƒ³','å³ãƒªãƒ¼ãƒ«å†ã‚¹ãƒ”ãƒ³'][i];
    b.style.padding='10px 14px'; b.style.fontWeight='700';
    b.onclick = ()=>{
      rerollReel(i);
      document.body.removeChild(overlay);
    };
    box.appendChild(b);
  }
  overlay.appendChild(box);
  document.body.appendChild(overlay);
}

/* -------------------------
   Spin / Reel logic
   ------------------------- */
const spinState = { forceWin:false };

function spin(){
  if(spinLock) return;
  const bet = 20;
  if(coin < bet){ alert('ã‚³ã‚¤ãƒ³ä¸è¶³'); return; }
  coin -= bet;
  updateUI();

  // start spinning visuals
  spinLock = true;
  for(let r=0;r<3;r++){
    spinning[r] = true;
    $(`stop${r}`).disabled = false;
    const cells = [ $(`cell${r}`), $(`cell${r+3}`), $(`cell${r+6}`) ];
    spinIntervals[r] = setInterval(()=>{
      cells.forEach(cell=>{
        const img = cell.querySelector('img');
        img.src = IMAGES.slots[randInt(IMAGES.slots.length)];
      });
    }, 80 + randInt(80));
  }

  // determine forceWin based on luck
  // base force: 5% + (min(luck,100)/100)*20% => 5%..25%
  let baseForce = 0.05 + (Math.min(luck,100)/100)*0.20;
  if(superspinActiveCount>0) baseForce += 0.20; // big boost
  spinState.forceWin = (Math.random() < baseForce);
  if(superspinActiveCount>0) superspinActiveCount--;
}

function stopReel(r){
  if(!spinning[r]) return;
  clearInterval(spinIntervals[r]);
  spinIntervals[r] = null;
  spinning[r] = false;
  $(`stop${r}`).disabled = true;

  if(!spinning[0] && !spinning[1] && !spinning[2]){
    finalizeSpin();
  }
}

function rerollReel(r){
  const cells = [ $(`cell${r}`), $(`cell${r+3}`), $(`cell${r+6}`) ];
  cells.forEach(cell=>{
    const img = cell.querySelector('img');
    img.src = IMAGES.slots[randInt(IMAGES.slots.length)];
  });
  // after reroll, evaluate immediately
  finalizeSpin();
}

/* finalizeSpin: apply forceWin if set, check for wins, handle insurance/double, end-turn effects */
function finalizeSpin(){
  // apply forceWin by making a random line all same symbol
  if(spinState.forceWin){
    const lines = [
      [0,1,2],[3,4,5],[6,7,8],
      [0,3,6],[1,4,7],[2,5,8],
      [0,4,8],[2,4,6]
    ];
    const chosen = lines[randInt(lines.length)];
    const symbol = IMAGES.slots[randInt(IMAGES.slots.length)];
    chosen.forEach(i=>{
      const el = $(`cell${i}`);
      el.querySelector('img').src = symbol;
    });
    spinState.forceWin = false;
  }

  // check win (any line full match)
  const grid = [];
  for(let i=0;i<9;i++){
    const el = $(`cell${i}`).querySelector('img');
    grid.push(el ? el.src : null);
  }
  const lines = [
    [0,1,2],[3,4,5],[6,7,8],
    [0,3,6],[1,4,7],[2,5,8],
    [0,4,8],[2,4,6]
  ];
  let hit = false;
  for(let line of lines){
    const [a,b,c] = line;
    if(grid[a] && grid[a]===grid[b] && grid[b]===grid[c]){ hit = true; break; }
  }

  const basePayout = 20 * 5; // 100
  if(hit){
    let payout = basePayout + Math.floor((Math.max(0, Math.floor((Math.min(luck,100)-50)/10))) * 10); // small influence
    if(doubleNext){ payout *= 2; doubleNext = false; showToast('2å€ã‚«ãƒ¼ãƒ‰åŠ¹æœç™ºå‹•ï¼'); }
    coin += payout;
    xp += 2;
    showToast(`ğŸ‰ æƒã„ï¼ é…å½“ + ${payout}`);
  } else {
    if(insuranceActive){
      coin += 20; // refund bet
      insuranceActive = false;
      showToast('ä¿é™ºç™ºå‹•ï¼šãƒ™ãƒƒãƒˆè¿”é‚„');
    } else {
      showToast('ãƒã‚ºãƒ¬â€¦');
    }
  }

  // end-of-turn effects:
  // mana +1
  mana += 1;

  // hand +1 (draw)
  drawCard();

  // randomize luck each turn (1..100) and allow superspin to add >100
  luck = randInt(100) + 1;
  // if superspin applied earlier it already influenced forceWin and decreased count; but keep it additive if needed:
  // (we allow luck to be temporarily bumped by effects that modify luck variable)
  updateSlotGlow();

  // level/xp system (light)
  const need = level * 5;
  if(xp >= need){
    xp -= need; level++; skillPoint += 3; coin += 10; mana += 2; showToast('ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ï¼ ã‚¹ã‚­ãƒ«P +3');
  }

  updateUI();

  // unlock spin
  spinLock = false;
}

/* -------------------------
   Luck -> slot glow (vivid colors, no white)
   rules:
    1-30: blue/purple
    31-70: green
    71-100: orange/red
    >100: rainbow (animated gradient)
   ------------------------- */
function updateSlotGlow(){
  const slotArea = $('slotGrid');
  // choose vivid colors
  if(luck > 100){
    // rainbow-ish
    slotArea.style.borderColor = '#ff00ff';
    slotArea.style.boxShadow = '0 0 30px rgba(255,0,255,0.25), 0 0 60px rgba(255,165,0,0.18)';
  } else if(luck > 70){
    slotArea.style.borderColor = '#ff5a1f'; // vivid orange/red
    slotArea.style.boxShadow = '0 0 28px rgba(255,90,31,0.18)';
  } else if(luck > 30){
    slotArea.style.borderColor = '#17c964'; // vivid green
    slotArea.style.boxShadow = '0 0 28px rgba(23,201,100,0.18)';
  } else {
    slotArea.style.borderColor = '#2f7dff'; // vivid blue
    slotArea.style.boxShadow = '0 0 28px rgba(47,125,255,0.18)';
  }
}

/* -------------------------
   Clicker behavior (click image fixed)
   ------------------------- */
$('clickImg')?.setAttribute('src', IMAGES.clicks[0]);

$('clickBtn').addEventListener('click', ()=>{
  // fixed click image
  $('clickImg').src = IMAGES.clicks[0];
  // coin gain
  let gain = clickPower + Math.floor(skillPoint/10); // small scaling
  coin += gain;
  updateUI();
});

/* auto clicker */
setInterval(()=>{
  if(autoPower>0){
    coin += autoPower + Math.floor(skillPoint/20);
    updateUI();
  }
},1000);

/* -------------------------
   Skill UI (kept minimal & non-intrusive)
   ------------------------- */
const skillDefs = {
  click: {name:'ã‚¯ãƒªãƒƒã‚¯å¼·åŒ–', lv:0, baseCost:2, costInc:1},
  auto:  {name:'è‡ªå‹•å¼·åŒ–', lv:0, baseCost:3, costInc:1},
  slot:  {name:'ã‚¹ãƒ­ãƒƒãƒˆè£œæ­£', lv:0, baseCost:4, costInc:1},
  luckS: {name:'ãƒ©ãƒƒã‚¯å¼·åŒ–', lv:0, baseCost:6, costInc:1},
  crit:  {name:'é»„é‡‘ã®æ‰‹', lv:0, baseCost:6, costInc:1},
  aura:  {name:'ç¥ç¦ã®ã‚ªãƒ¼ãƒ©', lv:0, baseCost:7, costInc:1}
};
function buildSkillUI(){
  const grid = $('skillsGrid');
  grid.innerHTML = '';
  for(const key in skillDefs){
    const s = skillDefs[key];
    const btn = document.createElement('button');
    btn.className='skill-btn';
    btn.id = 'skill_' + key;
    btn.innerHTML = `<div class="skill-line"><div>${s.name}</div><div>Lv ${s.lv}</div></div><div class="skill-meta">æ¬¡Lv ãƒãƒŠ:${s.baseCost + s.lv*s.costInc}</div>`;
    btn.onclick = ()=>{ tryUpgradeSkill(key); };
    grid.appendChild(btn);
  }
}
function tryUpgradeSkill(key){
  const s = skillDefs[key];
  const need = s.baseCost + s.lv*s.costInc;
  if(skillPoint <= 0){ showToast('ã‚¹ã‚­ãƒ«ãƒã‚¤ãƒ³ãƒˆãŒè¶³ã‚Šã¾ã›ã‚“'); return; }
  if(mana < need){ showToast('ãƒãƒŠãŒè¶³ã‚Šã¾ã›ã‚“'); return; }
  skillPoint--; mana -= need; s.lv++;
  // immediate effects minimal (visual)
  if(key==='auto') autoPower += 1;
  if(key==='click') clickPower += 1;
  buildSkillUI(); updateUI();
  showToast(`${s.name} ã‚’ Lv${s.lv} ã«ä¸Šã’ã¾ã—ãŸ`);
}

/* -------------------------
   UI update
   ------------------------- */
function updateUI(){
  $('coin').textContent = coin;
  $('mana').textContent = mana;
  $('xp').textContent = xp;
  $('level').textContent = level;
  $('xpFill').style.width = Math.min(100, (xp/(level*5)*100)) + '%';
  $('skillPoint').textContent = skillPoint;
  $('clickPower').textContent = clickPower;
  $('autoPower').textContent = autoPower;
}

/* -------------------------
   Initialization + bindings
   ------------------------- */
function setup(){
  // create 9 cells
  const grid = $('slotGrid');
  grid.innerHTML = '';
  for(let i=0;i<9;i++){
    const c = document.createElement('div'); c.className='cell'; c.id = 'cell'+i;
    const img = document.createElement('img'); img.src = IMAGES.slots[randInt(IMAGES.slots.length)];
    c.appendChild(img); grid.appendChild(c);
  }

  initDeck();
  // draw two starting cards
  drawCard(); drawCard();
  buildSkillUI();
  updateSlotGlow();
  updateUI();

  // bindings
  $('spinBtn').addEventListener('click', ()=>{ if(!spinLock) spin(); });
  $('stop0').addEventListener('click', ()=> stopReel(0));
  $('stop1').addEventListener('click', ()=> stopReel(1));
  $('stop2').addEventListener('click', ()=> stopReel(2));

  $('upgradeClick').addEventListener('click', ()=>{
    const need = 2 + skillDefs.click.lv * skillDefs.click.costInc;
    if(mana < need){ showToast('ãƒãƒŠä¸è¶³'); return; }
    mana -= need; skillDefs.click.lv++; clickPower += 1; updateUI();
  });
  $('upgradeAuto').addEventListener('click', ()=>{
    const need = 3 + skillDefs.auto.lv * skillDefs.auto.costInc;
    if(mana < need){ showToast('ãƒãƒŠä¸è¶³'); return; }
    mana -= need; skillDefs.auto.lv++; autoPower += 1; updateUI();
  });

  // click image default
  $('clickImg').src = IMAGES.clicks[0];
}

setup();

</script>
</body>
</html>
