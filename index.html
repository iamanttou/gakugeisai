<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>1to9 slot</title>
<style>
  :root{
    --bg:#222;
    --panel:#111;
    --muted:#666;
    --accent:#0a0;
  }
  html,body{height:100%;margin:0;background:var(--bg);color:#fff;font-family:system-ui, -apple-system, "Segoe UI", Roboto, "Hiragino Kaku Gothic ProN", "Noto Sans JP", Arial;}
  .outer{display:flex;justify-content:center;align-items:flex-start;padding:18px;min-height:100%;}
  .wrap{
    width:100%; max-width:1100px; box-sizing:border-box;
    display:flex;flex-direction:column;align-items:center;gap:12px;
    transform-origin:top center;
  }
  /* Responsive scaling so it fits smaller screens */
  @media (max-width:1100px){ .wrap{ max-width:96vw; } }
  @media (max-width:900px){ .wrap{ transform:scale(0.95); } }
  @media (max-width:600px){ .wrap{ transform:scale(0.78); } }

  /* slot area: 3 columns (reels) x 3 rows */
  .slot-area{
    display:grid;
    grid-template-columns:repeat(3, 1fr);
    gap:10px;
    width:100%;
    max-width:1000px;
    margin-bottom:6px;
  }
  .cell{
    aspect-ratio:8/5;           /* æ¨ªé•· */
    border:3px solid #444;
    border-radius:8px;
    display:flex;
    align-items:center;
    justify-content:center;
    background:var(--panel);
    overflow:hidden;
    position:relative;
  }
  .cell img{ width:100%; height:100%; object-fit:contain; user-drag:none; user-select:none; -webkit-user-drag:none; }

  /* Luckæ ã‚«ãƒ©ãƒ¼ */
  .lowLuck { border-color:#3ea9ff !important; }   /* å¯’è‰² */
  .midLuck { border-color:#7ed957 !important; }   /* ä¸­ç«‹ */
  .highLuck{ border-color:#ff6b6b !important; }   /* æš–è‰² */

  /* rerollé¸æŠ */
  .cell.selectable{ cursor:pointer; box-shadow:0 0 14px 6px rgba(255,215,0,0.18) inset; transform:translateY(-2px); }

  /* control row */
  .controls{ display:flex; gap:12px; align-items:center; flex-wrap:wrap; justify-content:center; margin-bottom:6px; }
  input[type=number]{ width:80px; padding:6px; border-radius:6px; border:2px solid #444; background:#111; color:#fff; }
  button{ padding:8px 12px; border-radius:8px; border:none; background:var(--accent); color:#fff; cursor:pointer; font-weight:600; }
  .stopBtns{ display:flex; gap:8px; }

  /* status */
  .status{ display:flex; gap:12px; flex-wrap:wrap; justify-content:center; width:100%; padding:8px 6px; border-top:3px solid #0f0; }
  .status .box{ background:#151515; padding:8px 12px; border-radius:8px; border:1px solid #333; min-width:120px; text-align:center; }
  .status .small{ font-size:0.85rem; color:#ccc; }

  /* hand */
  .hand{ width:100%; border:3px solid #c33; padding:10px; border-radius:8px; display:flex; gap:8px; justify-content:center; flex-wrap:wrap; background:#0a000000; box-sizing:border-box; }
  .card{ width:72px; aspect-ratio:5/8; border-radius:8px; background:#333; border:2px solid #666; display:flex; align-items:center; justify-content:center; position:relative; cursor:pointer; }
  .card img{ width:100%; height:100%; object-fit:contain; }
  .card .lv{ position:absolute; bottom:2px; right:4px; background:rgba(0,0,0,0.6); padding:2px 6px; border-radius:6px; font-size:0.72rem; }

  /* misc */
  .log{ max-height:120px; overflow:auto; width:100%; font-size:0.9rem; color:#ddd; background:#0e0e0e; padding:8px; border-radius:8px; border:1px solid #222; box-sizing:border-box; }
  .indicators{ display:flex; gap:8px; align-items:center; }
  .chip{ padding:6px 10px; border-radius:6px; background:#111; border:1px solid #333; }
</style>
</head>
<body>
  <div class="outer">
    <div class="wrap">

      <!-- ã‚¹ãƒ­ãƒƒãƒˆ -->
      <div class="slot-area" id="slotArea">
        <div class="cell" id="cell0"></div>
        <div class="cell" id="cell1"></div>
        <div class="cell" id="cell2"></div>
        <div class="cell" id="cell3"></div>
        <div class="cell" id="cell4"></div>
        <div class="cell" id="cell5"></div>
        <div class="cell" id="cell6"></div>
        <div class="cell" id="cell7"></div>
        <div class="cell" id="cell8"></div>
      </div>

      <!-- æ“ä½œ -->
      <div class="controls">
        <label>ãƒ™ãƒƒãƒˆ: <input id="betInput" type="number" min="1" value="1" /></label>
        <button id="spinBtn">ã‚¹ãƒ”ãƒ³é–‹å§‹</button>
        <div class="stopBtns">
          <button onclick="stopReel(0)">å·¦ãƒªãƒ¼ãƒ«åœæ­¢</button>
          <button onclick="stopReel(1)">ä¸­ãƒªãƒ¼ãƒ«åœæ­¢</button>
          <button onclick="stopReel(2)">å³ãƒªãƒ¼ãƒ«åœæ­¢</button>
        </div>

        <div class="indicators">
          <div class="chip">Luck: <span id="luckLabel">50</span></div>
          <div class="chip">å€ç‡: <span id="multLabel">x1.0</span></div>
          <div class="chip" id="jackChip" style="display:none;background:linear-gradient(90deg,#ffd166,#ff6b6b);">JACKPOT</div>
          <div class="chip" id="insChip" style="display:none;background:linear-gradient(90deg,#6bc1ff,#2a9d8f);">INSURANCE</div>
        </div>
      </div>

      <!-- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ -->
      <div class="status">
        <div class="box">ã‚³ã‚¤ãƒ³<br><strong id="coin">100</strong><div class="small">è³‡ç”£</div></div>
        <div class="box">ãƒãƒŠ<br><strong id="mana">0</strong><div class="small">ã‚¹ã‚­ãƒ«é€šè²¨</div></div>
        <div class="box">ã‚¿ãƒ¼ãƒ³<br><strong id="turn">1</strong><div class="small">çµŒé</div></div>
        <div class="box">ã‚³ãƒ³ãƒœ<br><strong id="combo">0</strong><div class="small">é€£å‹</div></div>
      </div>

      <!-- æ‰‹æœ­ -->
      <div class="hand" id="hand"></div>

      <!-- ãƒ­ã‚°ï¼ˆç°¡æ˜“ï¼‰ -->
      <div class="log" id="log"></div>
    </div>
  </div>

<script>
/* -----------------------------
   ã‚²ãƒ¼ãƒ çŠ¶æ…‹
   -----------------------------*/
let coin = 100;
let mana = 0;
let turn = 1;
let combo = 0;
let multiplier = 1;
let jackpot = false;
let luck = 50;
let insuranceActive = false;  // insurance ä½¿ç”¨çŠ¶æ…‹ï¼ˆæ¬¡ã®1ã‚¹ãƒ”ãƒ³ã§æå¤±è£œå„Ÿï¼‰
let lastBet = 0;              // ç›´å‰ã®ãƒ™ãƒƒãƒˆé¡ï¼ˆè£œå„Ÿã«ä½¿ã†ï¼‰
let hand = [];
let deck = [];
let discard = [];
let maxHand = 7;

/* -----------------------------
   ç”»åƒãƒªã‚¹ãƒˆï¼ˆGitHub images/ ã«é…ç½®ï¼‰
   slot1~slot9.png, card1~card7.png ã‚’æƒ³å®š
   -----------------------------*/
const symbols = [
  "images/slot1.png",
  "images/slot2.png",
  "images/slot3.png",
  "images/slot4.png",
  "images/slot5.png",
  "images/slot6.png",
  "images/slot7.png",
  "images/slot8.png",
  "images/slot9.png"
];

const cardTypesBase = [
  {img:"images/card1.png", type:"reroll", cost:2, level:1, name:"Reroll"},
  {img:"images/card2.png", type:"double", cost:2, level:1, name:"Double"},
  {img:"images/card3.png", type:"wild", cost:3, level:1, name:"Wild"},
  {img:"images/card4.png", type:"insurance", cost:2, level:1, name:"Insurance"},
  {img:"images/card5.png", type:"superspin", cost:3, level:1, name:"Superspin"},
  {img:"images/card6.png", type:"manarecover", cost:1, level:1, name:"Mana+"},
  {img:"images/card7.png", type:"coinplus", cost:1, level:1, name:"Coin+"}
];

/* -----------------------------
   åˆæœŸåŒ–ç³»
   -----------------------------*/
function initDeck(){
  deck = [];
  for(let i=0;i<3;i++){
    // ãƒ‡ã‚£ãƒ¼ãƒ—ã‚³ãƒ”ãƒ¼ã§ãƒ¬ãƒ™ãƒ«æƒ…å ±ãŒã‚«ãƒ¼ãƒ‰ã”ã¨ã«ç‹¬ç«‹ã™ã‚‹ã‚ˆã†ã«ã™ã‚‹
    deck = deck.concat(cardTypesBase.map(c => ({...c})));
  }
  shuffle(deck);
}

function shuffle(a){
  for(let i=a.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [a[i], a[j]] = [a[j], a[i]];
  }
}

/* -----------------------------
   ã‚«ãƒ¼ãƒ‰ï¼ˆæ‰‹æœ­ï¼‰å‡¦ç†
   -----------------------------*/
function drawCard(){
  if(hand.length >= maxHand) return;
  if(deck.length === 0){
    deck = discard;
    discard = [];
    shuffle(deck);
  }
  if(deck.length > 0){
    const c = deck.pop();
    hand.push(c);
    renderHand();
    log(`ã‚«ãƒ¼ãƒ‰ã‚’1æšãƒ‰ãƒ­ãƒ¼: ${c.name} (Lv${c.level})`);
  }
}

function renderHand(){
  const root = document.getElementById("hand");
  root.innerHTML = "";
  hand.forEach((card, idx) => {
    const el = document.createElement("div");
    el.className = "card";
    const img = document.createElement("img");
    img.src = card.img;
    el.appendChild(img);
    const lv = document.createElement("div");
    lv.className = "lv";
    lv.textContent = "Lv"+card.level;
    el.appendChild(lv);
    el.onclick = ()=>playCard(idx);
    root.appendChild(el);
  });
}

function playCard(idx){
  // safety: index may change if hand re-rendered
  if(idx < 0 || idx >= hand.length) return;
  const card = hand[idx];
  if(mana < card.cost){
    log("ãƒãƒŠä¸è¶³ã§ã‚«ãƒ¼ãƒ‰ä½¿ç”¨ä¸å¯");
    return;
  }
  mana -= card.cost;

  // remove from hand and push to discard (preserve level)
  const used = hand.splice(idx,1)[0];
  discard.push(used);

  // ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ï¼ˆä½¿ç”¨ã§çµŒé¨“ï¼‰
  if(used.level < 3) used.level++;

  renderHand();
  log(`ã‚«ãƒ¼ãƒ‰ä½¿ç”¨: ${used.name} Lv${used.level} (ã‚³ã‚¹ãƒˆ ${used.cost})`);
  applyEffect(used);
  updateStatus();
}

/* -----------------------------
   ã‚«ãƒ¼ãƒ‰åŠ¹æœï¼ˆå¼·åŒ–åæ˜ æ¸ˆã¿ï¼‰
   -----------------------------*/
let selectingReel = false; // reroll Lv3 é¸æŠå¾…ã¡ãƒ•ãƒ©ã‚°
function applyEffect(card){
  switch(card.type){
    case "coinplus":
      if(card.level===1) coin += 5;
      else if(card.level===2) coin += 10;
      else coin += 20;
      log(`coin+ åŠ¹æœç™ºå‹• (+${card.level===1?5:card.level===2?10:20})`);
      break;

    case "manarecover":
      if(card.level===1) mana += 2;
      else if(card.level===2) mana += 4;
      else mana += 6;
      log(`mana å›å¾© (${card.level})`);
      break;

    case "double":
      // å€ç‡ã¯ãƒ¬ãƒ™ãƒ«ã§å¤‰åŒ–ï¼ˆç”»é¢è¡¨ç¤ºã®å€ç‡ã«å½±éŸ¿ï¼‰
      if(card.level===1) { coin *= 2; log("Double x2!"); }
      else if(card.level===2) { coin *= 3; log("Double x3!"); }
      else { coin *= 5; log("Double x5!"); }
      break;

    case "reroll":
      if(card.level===1){ spin(true,1); log("Reroll Lv1: å…¨ãƒªãƒ¼ãƒ« 1å›ï¼ˆã‚«ãƒ¼ãƒ‰ã‚¹ãƒ”ãƒ³ï¼‰"); }
      else if(card.level===2){ spin(true,2); log("Reroll Lv2: å…¨ãƒªãƒ¼ãƒ« 2å›ï¼ˆã‚«ãƒ¼ãƒ‰ã‚¹ãƒ”ãƒ³ï¼‰"); }
      else { enableReelSelection(); log("Reroll Lv3: åˆ—ã‚’é¸æŠã—ã¦å†ã‚¹ãƒ”ãƒ³"); }
      break;

    case "superspin":
      spin(true,3); log("Superspin: 3å›åˆ†ã‚¹ãƒ”ãƒ³ï¼ˆã‚«ãƒ¼ãƒ‰ï¼‰");
      break;

    case "wild":
      for(let i=0;i<9;i++){
        const cell = document.getElementById("cell"+i);
        cell.innerHTML = "";
        const img = document.createElement("img");
        img.src = symbols[3] || symbols[0]; // slot4 ç³»ã‚’ãƒ¯ã‚¤ãƒ«ãƒ‰ã«
        cell.appendChild(img);
      }
      log("Wildç™ºå‹•: å…¨ã‚»ãƒ«ã‚’ãƒ¯ã‚¤ãƒ«ãƒ‰ã«");
      break;

    case "insurance":
      insuranceActive = true;
      document.getElementById("insChip").style.display = "inline-block";
      log("Insurance ä½¿ç”¨: æ¬¡ã®1ã‚¹ãƒ”ãƒ³ã®æå¤±ã‚’è£œå„Ÿã—ã¾ã™");
      break;
  }
  updateStatus();
}

/* -----------------------------
   reroll Lv3: åˆ—é¸æŠå‡¦ç†
   -----------------------------*/
function enableReelSelection(){
  selectingReel = true;
  for(let r=0;r<3;r++){
    for(let i=0;i<3;i++){
      const id = r*3 + i;
      const cell = document.getElementById("cell"+id);
      cell.classList.add("selectable");
      // store handler closure per cell to avoid overwrite issues
      cell.onclick = (ev) => {
        // ignore if not selecting
        if(!selectingReel) return;
        spinReel(r);
      };
    }
  }
  alert("Reroll Lv3: å›ã—ãŸã„ãƒªãƒ¼ãƒ«ï¼ˆåˆ—ï¼‰ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„");
}

function spinReel(r){
  if(!selectingReel) return;
  selectingReel = false;
  // clear selectable
  for(let i=0;i<9;i++){
    const cell = document.getElementById("cell"+i);
    cell.classList.remove("selectable");
    cell.onclick = null;
  }
  // re-roll only chosen reel (3 cells)
  for(let i=0;i<3;i++){
    const id = r*3 + i;
    const cell = document.getElementById("cell"+id);
    cell.innerHTML = "";
    const img = document.createElement("img");
    img.src = randomSymbolWithLuck();
    cell.appendChild(img);
  }
  log(`Reroll: åˆ— ${r+1} ã‚’å†æŠ½é¸`);
  // åˆ¤å®šï¼ˆé¸æŠã«ã‚ˆã‚‹å³æ™‚ãƒã‚§ãƒƒã‚¯ï¼‰
  checkWinAfterSpin();
}

/* -----------------------------
   ã‚¹ãƒ”ãƒ³é–¢é€£ï¼ˆãƒªãƒ¼ãƒ«åœæ­¢æ–¹å¼ï¼‰
   -----------------------------*/
let spinIntervals = [null,null,null];
let spinning = [false,false,false];

function randomSymbolWithLuck(){
  // ã‚·ãƒ³ãƒ—ãƒ«ãªè£œæ­£: luck ãŒé«˜ã„ã¨åŒã˜ã‚·ãƒ³ãƒœãƒ«ï¼ˆsymbols[0]ï¼‰ãŒå‡ºã‚„ã™ããªã‚‹ã€‚
  // ã“ã“ã¯å°†æ¥ã‚·ãƒ³ãƒœãƒ«åˆ¥åŠ¹æœã«åˆã‚ã›ã¦ç´°ã‹ãã§ãã¾ã™ï¼ˆæƒœã—ã„ã‚ºãƒ¬ãªã©ï¼‰ã€‚
  if(Math.random()*100 < Math.min(luck,95)){ // luck% ã®ç¢ºç‡ã§åã‚Šã‚’å‡ºã™
    // åã‚Šã®å‡ºã—æ–¹: 50%ã¯ symbols[0]ã€æ®‹ã‚Šã¯ãƒ©ãƒ³ãƒ€ãƒ 
    if(Math.random() < 0.5) return symbols[0];
    return symbols[Math.floor(Math.random()*symbols.length)];
  } else {
    return symbols[Math.floor(Math.random()*symbols.length)];
  }
}

function spin(isCard=false, times=1){
  // isCard==false ã®æ™‚ã¯é€šå¸¸ã‚¹ãƒ”ãƒ³ï¼ˆã‚³ã‚¤ãƒ³ã‚’æ‰•ã†ï¼‰
  const bet = parseInt(document.getElementById("betInput").value) || 1;
  if(!isCard){
    if(coin < bet){
      alert("ã‚³ã‚¤ãƒ³ãŒè¶³ã‚Šã¾ã›ã‚“");
      return;
    }
    coin -= bet;
    lastBet = bet;
    log(`ãƒ™ãƒƒãƒˆ ${bet} ã‚’æ¶ˆè²»ã—ã¦ã‚¹ãƒ”ãƒ³é–‹å§‹`);
  } else {
    log(`ã‚«ãƒ¼ãƒ‰ã‚¹ãƒ”ãƒ³ï¼ˆæ¶ˆè²»ãªã—ï¼‰ x${times}`);
  }

  updateStatus();
  // é–‹å§‹ï¼šå…¨ãƒªãƒ¼ãƒ«ã‚’å›ã™
  for(let r=0;r<3;r++){
    spinning[r] = true;
    spinIntervals[r] = setInterval(()=>{
      for(let i=0;i<3;i++){
        const id = r*3 + i;
        const cell = document.getElementById("cell"+id);
        cell.innerHTML = "";
        const img = document.createElement("img");
        img.src = randomSymbolWithLuck();
        cell.appendChild(img);
      }
    }, 80);
  }

  // luck ã‚’ã‚¿ãƒ¼ãƒ³ä¸­ã«å¾®å¤‰å‹•ã•ã›ã‚‹ï¼ˆæ¼”å‡ºï¼‰
  // ãŸã ã—ã‚¿ãƒ¼ãƒ³æ›´æ–°ã¯ endTurn ã§è¡Œã†ãŸã‚ã“ã“ã§ã¯è¦–è¦šå¤‰åŒ–ã ã‘
  // timesã¯æœªä½¿ç”¨ã§ç°¡æ˜“ç‰ˆï¼ˆè¤‡æ•°å›ã¯ã‚«ãƒ¼ãƒ‰åŠ¹æœã§ã¯åˆ¥ã«æ‰±ã‚ã‚Œã‚‹ï¼‰
  updateLuck(); // ã‚¹ãƒ”ãƒ³é–‹å§‹æ™‚ã«ã‚‚luckå¤‰å‹•ã‚’å…¥ã‚Œã‚‹ï¼ˆã‚¿ãƒ¼ãƒ³ã”ã¨ã§ã¯ãªã„ãŒæ¼”å‡ºçš„ï¼‰
}

/* stopReel ã¯ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒæŠ¼ã™åœæ­¢ãƒœã‚¿ãƒ³ç”¨ï¼ˆåˆ—ã”ã¨ï¼‰ */
function stopReel(r){
  if(!spinning[r]) return;
  clearInterval(spinIntervals[r]);
  spinning[r] = false;
  log(`ãƒªãƒ¼ãƒ« ${r+1} åœæ­¢`);
  // å…¨ãƒªãƒ¼ãƒ«åœæ­¢ã—ãŸã‚‰åˆ¤å®šï¼†ã‚¿ãƒ¼ãƒ³çµ‚äº†å‡¦ç†
  if(!spinning.some(x=>x)){
    checkWinAfterSpin();
    endTurn(); // ã‚¿ãƒ¼ãƒ³çµ‚äº†å‡¦ç†ï¼ˆã‚«ãƒ¼ãƒ‰+1, mana+1, luckå¤‰å‹•, eventsï¼‰
  }
}

/* åˆ¤å®šï¼ˆã‚¹ãƒ”ãƒ³å¾Œï¼‰ */
function checkWinAfterSpin(){
  // ä¸­æ®µã®3ã‚»ãƒ«ï¼ˆrow=1 : cell3,4,5ï¼‰ã‚’åˆ¤å®š
  const mid0 = document.getElementById("cell3").firstChild?.src || "";
  const mid1 = document.getElementById("cell4").firstChild?.src || "";
  const mid2 = document.getElementById("cell5").firstChild?.src || "";

  if(mid0 && mid0===mid1 && mid1===mid2){
    // å½“ãŸã‚Š
    combo++;
    multiplier = Math.min(1 + combo*0.5, 5);
    let bet = lastBet || (parseInt(document.getElementById("betInput").value) || 1);
    let reward;
    if(jackpot){
      reward = bet * 50;
      jackpot = false;
      document.getElementById("jackChip").style.display = "none";
      log("JACKPOT ãŒç™ºå‹•ï¼ å¤§å½“ãŸã‚Šï¼");
    } else {
      reward = Math.floor(bet * 5 * multiplier);
    }
    coin += reward;
    log(`ä¸­æ®µæƒã„ï¼ +${reward} ã‚³ã‚¤ãƒ³ (å€ç‡ x${multiplier.toFixed(2)})`);
    alert(`ä¸­æ®µæƒã„ï¼ +${reward} ã‚³ã‚¤ãƒ³ (å€ç‡ x${multiplier.toFixed(2)})`);
  }else{
    // å¤–ã‚Œ
    // insurance ãŒã‚ã‚Œã°ãƒ™ãƒƒãƒˆã‚’è¿”å´ï¼ˆæå¤±ãªã—ï¼‰
    if(insuranceActive && lastBet > 0){
      coin += lastBet;
      log(`Insurance ã«ã‚ˆã‚Šãƒ™ãƒƒãƒˆ ${lastBet} ã‚’è£œå„Ÿ`);
      alert(`ä¿é™ºãŒé©ç”¨ã•ã‚Œã¾ã—ãŸã€‚ãƒ™ãƒƒãƒˆ ${lastBet} ã‚’è¿”å´`);
      insuranceActive = false;
      document.getElementById("insChip").style.display = "none";
    } else {
      log("å¤–ã‚Œ");
    }
    combo = 0;
    multiplier = 1;
  }
  // ã‚¹ãƒ”ãƒ³å¾Œã¯ lastBet ã‚’ã‚¯ãƒªã‚¢ï¼ˆä¿é™ºã¯ä¸Šã§è§£é™¤æ¸ˆã¿ï¼‰
  lastBet = 0;
  updateStatus();
}

/* -----------------------------
   ã‚¿ãƒ¼ãƒ³çµ‚äº†å‡¦ç†ï¼šã‚«ãƒ¼ãƒ‰+1, ãƒãƒŠ+1, Luckå¤‰å‹•, ã‚¤ãƒ™ãƒ³ãƒˆåˆ¤å®š
   -----------------------------*/
function endTurn(){
  // 1ã‚¿ãƒ¼ãƒ³çµŒéï¼ˆã‚¹ãƒ”ãƒ³1å›ã‚’ã‚¿ãƒ¼ãƒ³ã¨ã™ã‚‹ï¼‰
  mana++;
  drawCard();
  turn++;
  // Luck ã¯ã‚¿ãƒ¼ãƒ³ã”ã¨ã«ä¹±æ•°ã§å¤‰å‹•ï¼ˆå‰å›å€¤ Â±20ï¼‰
  updateLuck();

  // 5ã‚¿ãƒ¼ãƒ³ã”ã¨ã«ã‚¤ãƒ™ãƒ³ãƒˆ
  if(turn % 5 === 0){
    triggerEvent();
  }

  updateStatus();
}

/* Luck æ›´æ–°ï¼ˆã‚¿ãƒ¼ãƒ³ã”ã¨ã«å‘¼ã¶ï¼‰ */
function updateLuck(){
  const delta = Math.floor(Math.random()*41) - 20; // -20 .. +20
  luck = Math.max(0, Math.min(100, luck + delta));
  document.getElementById("luckLabel").textContent = luck;
  // æ›´æ–°ã«ä¼´ã„ã‚»ãƒ«æ è‰²ã‚’åæ˜ 
  updateLuckFrame();
}

/* ã‚»ãƒ«ã®æ è‰²ã‚’Luckã«å¿œã˜ã¦å¤‰æ›´ */
function updateLuckFrame(){
  const cells = document.querySelectorAll(".cell");
  cells.forEach(c=>{
    c.classList.remove("lowLuck","midLuck","highLuck");
    if(luck < 35) c.classList.add("lowLuck");
    else if(luck > 65) c.classList.add("highLuck");
    else c.classList.add("midLuck");
  });
  document.getElementById("luckLabel").textContent = luck;
}

/* -----------------------------
   ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆ5ã‚¿ãƒ¼ãƒ³ã”ã¨ï¼‰
   -----------------------------*/
function triggerEvent(){
  const ev = Math.floor(Math.random()*3);
  if(ev===0){
    luck = Math.min(100, luck + 30);
    log("ã‚¤ãƒ™ãƒ³ãƒˆ: ã‚¹ãƒ¼ãƒ‘ãƒ¼ãƒãƒ£ãƒ³ã‚¹ï¼ï¼ˆLuck +30ï¼‰");
    alert("ğŸ”¥ ã‚¹ãƒ¼ãƒ‘ãƒ¼ãƒãƒ£ãƒ³ã‚¹ï¼ Luckä¸Šæ˜‡ ğŸ”¥");
  } else if(ev===1){
    luck = Math.max(0, luck - 30);
    log("ã‚¤ãƒ™ãƒ³ãƒˆ: å†·å´ã‚¿ã‚¤ãƒ ï¼ˆLuck -30ï¼‰");
    alert("â„ å†·å´ã‚¿ã‚¤ãƒ â€¦ Luckä½ä¸‹ â„");
  } else {
    jackpot = true;
    document.getElementById("jackChip").style.display = "inline-block";
    log("ã‚¤ãƒ™ãƒ³ãƒˆ: ã‚¸ãƒ£ãƒƒã‚¯ãƒãƒƒãƒˆãƒãƒ£ãƒ³ã‚¹ç™ºç”Ÿï¼");
    alert("ğŸ’° ã‚¸ãƒ£ãƒƒã‚¯ãƒãƒƒãƒˆãƒãƒ£ãƒ³ã‚¹ï¼ æ¬¡ã®å½“ãŸã‚Šã¯å¤§å½“ãŸã‚Š ğŸ’°");
  }
  updateLuckFrame();
}

/* -----------------------------
   ãƒ˜ãƒ«ãƒ‘ãƒ¼ã€UI æ›´æ–°ã€ãƒ­ã‚°
   -----------------------------*/
function updateStatus(){
  document.getElementById("coin").textContent = coin;
  document.getElementById("mana").textContent = mana;
  document.getElementById("turn").textContent = turn;
  document.getElementById("combo").textContent = combo;
  document.getElementById("multLabel").textContent = "x" + multiplier.toFixed(2);
  document.getElementById("luckLabel").textContent = luck;
  document.getElementById("insChip").style.display = insuranceActive ? "inline-block" : "none";
  document.getElementById("jackChip").style.display = jackpot ? "inline-block" : "none";
}

function log(text){
  const el = document.getElementById("log");
  const t = new Date().toLocaleTimeString();
  el.innerHTML = `<div>[${t}] ${text}</div>` + el.innerHTML;
}

/* -----------------------------
   åˆæœŸåŒ–ãƒ»ãƒã‚¤ãƒ³ãƒ‰
   -----------------------------*/
initDeck();
drawCard();            // åˆæœŸã‚«ãƒ¼ãƒ‰1æš
updateLuckFrame();
updateStatus();

document.getElementById("spinBtn").onclick = ()=> spin(false);
</script>
</body>
</html>
